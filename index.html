<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Minimal TM</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        .task-done {
            text-decoration: line-through;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6 text-center">
                <h1 id="todayDate"></h1>
                <div class="row gap-2">
                    <div class="col-sm-12">
                        <input type="text" id="taskInput" class="form-control" placeholder="Enter new task" onkeydown="if(event.key === 'Enter') addTask()">
                    </div>
                    <div class="col-sm-12 d-flex justify-content-start">
                        <button class="btn btn-dark btn-sm" id="clearAllTask">Clear All</button>
                    </div>
                </div>
                
                <ul id="taskList" class="list-group mt-3"></ul>
            </div>
        </div>
    </div>
    <script>
        // Display today's date
        document.getElementById('todayDate').innerText = new Date().toLocaleDateString();

        // Load tasks from local storage
        document.addEventListener('DOMContentLoaded', loadTasks);
        const clearAllTasks = document.getElementById('clearAllTask')

        // Function to add a new task
        function addTask() {
            const taskInput = document.getElementById('taskInput');
            const taskText = taskInput.value.trim();
            if (taskText === '') return;

            const taskList = document.getElementById('taskList');
            const taskItem = createTaskItem(taskText);
            taskList.appendChild(taskItem);

            saveTasks();
            taskInput.value = '';
        }

        // Function to create a task item
        function createTaskItem(text, done = false) {
            const li = document.createElement('li');
            li.className = 'list-group-item d-flex ';

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.checked = done;
            checkbox.addEventListener('click', () => {
                li.classList.toggle('task-done', checkbox.checked);
                saveTasks();
            });

            const span = document.createElement('span');
            span.className = 'ms-2 text-start'
            span.innerText = text;
            if (done) span.classList.add('task-done');

            li.appendChild(checkbox);
            li.appendChild(span);

            return li;
        }

        // Function to save tasks to local storage
        function saveTasks() {
            const tasks = [];
            document.querySelectorAll('#taskList li').forEach(li => {
                const checkbox = li.querySelector('input[type="checkbox"]');
                const text = li.querySelector('span').innerText;
                tasks.push({ text, done: checkbox.checked });
            });
            localStorage.setItem('tasks', JSON.stringify(tasks));
        }

        // Function to load tasks from local storage
        function getTasks() {
            return JSON.parse(localStorage.getItem('tasks')) || []
        }
        function loadTasks() {
            const tasks = getTasks()
            const taskList = document.getElementById('taskList');
            if(!tasks.length) taskList.innerHTML = ''
            tasks.forEach(task => {
                const taskItem = createTaskItem(task.text, task.done);
                taskList.appendChild(taskItem);
            });
        }

        //  Delete All the Tasks
        clearAllTasks.addEventListener('click',() => {
            if(!getTasks().length) return
            if(!confirm('Are you sure?')) return
            localStorage.removeItem('tasks')
            loadTasks()
        })

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/service-worker.js').then(function(registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>
</html>
